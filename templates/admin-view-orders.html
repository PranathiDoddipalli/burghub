{% include "admin-head-active.html" %}

<section id="about">
    <div class="container">
        <h2 style="text-align: center; color: #eb8314; margin-top: 150px; margin-bottom: 20px">
            Current and older orders
        </h2>
        {% for order in orders %}
        <section id="cart" class="section-p1">
            <table width="100%" style="margin-top: 50px">
                <thead>
                    <tr>
                        <td>Order Id : <span class="order-head">#{{getUpperIdFromOrderId(order['_id'])}}</span></td>
                        <td>Receive Method: <span class="order-head">{{order['delivery_type']}}</span></td>

                        <td>Order Date : <span class="order-head">{{order['order_date']}}</span></td>
                        <td>Total : <span class="order-head">{{order['amount']}}</span></td>
                        <td>Status: {{order['status']}}</td>
                        <td>
                            ACTION: {% if order['delivery_type'] == "delivery" %} {%if order['status'] == 'pending':%}
                            <div>
                                <div class="form accept-reject">
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=rejected">
                                            <button class="btn btn-normal">Reject</button>
                                        </a>
                                    </div>
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=accepted">
                                            <button style="padding: 5px 20px" class="btn btn-normal">Accept</button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {%elif order['status'] == 'rejected'%}
                            <div>
                                <div>
                                    <span>No Action</span>
                                </div>
                            </div>
                            {%elif order['status'] == 'accepted'%}
                            <div>
                                <div class="form">
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=prepared">
                                            <button style="padding: 5px 20px" class="btn btn-normal">
                                                Order Prepared
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {%elif order['status'] == 'prepared'%}
                            <form action="admin-order" class="form">
                                <input type="hidden" name="order_id" value="{{order['_id']}}" />
                                <input type="hidden" name="action" value="assigned" />
                                <div class="input-section">
                                    <select name="delivery_id" required class="btn btn-normal">
                                        <option value="">Assign to Delivery</option>
                                        {%for agent in delivery_agents:%}
                                        <option value="{{agent['_id']}}">{{agent['name']}}</option>
                                        {%endfor%}
                                    </select>
                                    <button style="padding: 5px 20px" class="normal">Assign</button>
                                </div>
                            </form>
                            {%endif%} {%elif order['delivery_type'] == 'pickup'%} {%if order['status'] == 'pending' %}
                            <div>
                                <div class="form accept-reject">
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=rejected">
                                            <button style="padding: 5px 20px" class="btn btn-normal">Reject</button>
                                        </a>
                                    </div>
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=accepted">
                                            <button style="padding: 5px 20px" class="btn btn-normal">Accept</button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {%elif order['status'] == 'rejected'%}
                            <div>
                                <span>No Action</span>
                            </div>
                            {%elif order['status'] == 'accepted'%}
                            <div>
                                <div class="form">
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=prepared">
                                            <button style="padding: 5px 20px" class="btn btn-normal">
                                                Order Prepared
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {%elif order['status'] == 'prepared'%}
                            <div>
                                <div class="form">
                                    <div class="input-section">
                                        <a href="/admin-order?order_id={{order['_id']}}&action=picked">
                                            <button style="padding: 5px 20px" class="btn btn-normal">
                                                Picked-up food
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {%endif%} {%endif%}
                        </td>
                    </tr>
                </thead>

                <tbody>
                    <tr style="display: none">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <table width="100%">
                <thead>
                    <tr>
                        <td>Item</td>
                        <td>Product</td>
                        <td>Item</td>
                        <td>Price / Unit</td>
                        <td>Quantity</td>
                        <td>Subtotal</td>
                    </tr>
                </thead>
                {% set items = order.get('items',[]) %}
                <tbody>
                    {%for item in items:%} {% set productInfo = item %} {% set product_id = productInfo['product_id'] %}
                    {% set product = get_product_by_product_id(product_id) %} {%if product:%}
                    <tr>
                        <td>{{loop.index}}</td>
                        <td><img src="../static/images/{{product['picture']}}" alt="" /></td>
                        <td>{{product['name']}}</td>
                        <td>${{product['price']}}</td>
                        <td>{{productInfo['quantity']}}</td>
                        <td>${{product['price'] | int * productInfo['quantity'] | int}}</td>
                    </tr>
                    {%endif%} {%endfor%}
                </tbody>
            </table>
        </section>
        {%endfor%}
    </div>
</section>

{% include "footer.html" %}
